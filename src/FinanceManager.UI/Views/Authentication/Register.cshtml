@{
    ViewData["Title"] = "Register";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<form id="register-form" class="needs-validation" action="/authentication/register" method="post" novalidate>
    <div class="form-group">
        <label for="email">Email</label>
        <input type="email" class="form-control" id="Email" name="Email">
        <div id="Email-invalid-feedback" class="invalid-feedback"></div>
    </div>
    <div class="form-group">
        <label for="Password">Password</label>
        <input type="password" class="form-control" id="Password" name="Password">
        <div id="Password-invalid-feedback" class="invalid-feedback"></div>
    </div>
    <div class="form-group">
        <label for="ConfirmPassword">Confirm Password</label>
        <input type="password" class="form-control" id="ConfirmPassword" name="ConfirmPassword">
        <div id="ConfirmPassword-invalid-feedback" class="invalid-feedback"></div>
    </div>
    <div class="form-check">
        <input type="checkbox" class="form-check-input no-validate" id="RememberMe" name="RememberMe" value="true">
        <label class="form-check-label no-validate" for="RememberMe">Remember me</label>
    </div>
    <button type="submit" class="btn btn-primary">Register</button>
</form>

@section scripts{
    <script>

        //form
        var form = document.getElementById("register-form");
        //inputs
        var email = document.getElementById("Email");
        var password = document.getElementById("Password");
        var confirm_password = document.getElementById("ConfirmPassword");
        //messages
        var email_invalid_feedback = document.getElementById("Email-invalid-feedback");
        var password_invalid_feedback = document.getElementById("Password-invalid-feedback");
        var confirmpassword_invalid_feedback = document.getElementById("ConfirmPassword-invalid-feedback");

        function validateForm(form){
            var valid = true;
            
            email.setCustomValidity("");
            if(email.value == ""){
                email.setCustomValidity("Required field");
                valid = false;
            }
            else if(!(/^[a-z0-9!'#$%&*+\/=?^_`{|}~-]+(?:\.[a-z0-9!'#$%&*+\/=?^_`{|}~-]+)*@@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-zA-Z]{2,}$/.test(email.value))){
                email.setCustomValidity("Invalid format");
                valid = false;
            }

            password.setCustomValidity("");
            if(password.value == ""){
                password.setCustomValidity("Required field");
                valid = false;
            }
            else if(!(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^a-zA-Z0-9]).{8,}$/.test(password.value))){
                password.setCustomValidity("Invalid format");
                valid = false;
            }

            confirm_password.setCustomValidity("");
            if(confirm_password.value == ""){
                confirm_password.setCustomValidity("Required field");
                valid = false;
            }
            else if(password.value != confirm_password.value){
                confirm_password.setCustomValidity("Passwords Don't Match");
                valid = false;
            }

            email.parentNode.classList.add('was-validated');
            password.parentNode.classList.add('was-validated');
            confirm_password.parentNode.classList.add('was-validated');
            email_invalid_feedback.innerText = email.validationMessage;
            password_invalid_feedback.innerText = password.validationMessage;
            confirmpassword_invalid_feedback.innerText = confirm_password.validationMessage;

            return valid;
        }

        
        form.addEventListener('submit', event => {
            if (!validateForm(form)) {
                event.preventDefault()
                event.stopPropagation()
            }
        }, false);

        email.addEventListener('keyup', event => {
            validateForm(form);
        }, false);

        password.addEventListener('keyup', event => {
            validateForm(form);
        }, false);

        confirm_password.addEventListener('keyup', event => {
            validateForm(form);
        }, false);

    </script>
}
